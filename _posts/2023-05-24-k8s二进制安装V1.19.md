---
layout:  single
title:  "kubernetes二进制安装 - V1.19"
date:   2023-05-24 
categories:   [kubernetes]
classes: wide
---

## 一，基础环境分配

```shell
10.102.4.13 #hostnamectl set-hostname k8s-master1
10.102.4.15 #k8s-node1
10.102.4.14 #k8s-node2

10.102.4.13 #etcd
10.102.4.15 #etcd
10.102.4.14 #etcd

10.102.4.13 	#cfssl生成证书
以上机器都是2c3G
以上机器有重复利用，机器多可以分开布置
替换相应的IP即可
```

## 二，基础环境部署

### 2.1 关闭selinux/firewalld设置

#### 2.1.1 临时关闭

``` shell 
systemctl stop firewalld #临时关闭firewalld
setenforce 0 #临时关闭

```

#### 2.1.2 永久关闭

```shell
systemctl disable firewalld #永久关闭firewalld

vi  /etc/selinux/config #永久关闭SElinux

SELINUX=disable


```

### 2.2 关闭swap

2.2.1 临时关闭

```shell
swapoff -a #第一步 关闭swap分区
vi  /etc/fstab
 /dev/mapper/centos-swap swap defaults 0 0 #注释此行
 #/dev/mapper/centos-swap swap                    swap    defaults        0 0

free -m #查看是否关闭 若swap行都显示 0 则表示关闭成功
```



2.2.2 永久关闭

```shell
vim /etc/sysctl.conf # 永久生效
修改 vm.swappiness 的修改为 0
vm.swappiness=0
sysctl -p # 使配置生效
vi  /etc/fstab
 /dev/mapper/centos-swap swap defaults 0 0 #注释此行
 #/dev/mapper/centos-swap swap                    swap    defaults        0 0
 ##重启init 6
```

或者

```shell
#关闭swap
swapoff -a  # 临时 
sed -ri 's/.*swap.*/#&/' /etc/fstab    # 永久
```

这里要永久关闭selinux、firewalld，swap

### 2.3修改主机名、加域名解析

#### 2.3.1 修改主机名

```shell
10.102.4.13
hostnamectl set-hostname k8s-master1
10.102.4.15
hostnamectl set-hostname k8s-node1
10.102.4.14
hostnamectl set-hostname k8s-node2
192.168.1.23
hostnamectl set-hostname k8s-master2
```

#### 2.3.2 加域名解析

```shell
##所有机器10.102.4.13-15
vim /etc/hosts

10.102.4.13 k8s-master1
10.102.4.15 k8s-node1
10.102.4.14 k8s-node2
192.168.1.23 k8s-master2
```

#### 2.3.3做流量转发

```shell
# 将桥接的IPv4流量传递到iptables的链 
vim /etc/sysctl.d/k8s.conf 
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1

sysctl --system  # 生效
```
